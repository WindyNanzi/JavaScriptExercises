<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>shink-and-grow</title>
  <link rel="stylesheet" href="./shrink-and-grow.css">
</head>

<body>
  <h2>flex-grow</h2>
  <section class="grow">
    <h3>test:</h3>
    <pre>
      容器宽度：600px
      flex-shrink：1 , 3 , 2 
      flex-basis: 50px, 100px, 150px
      求各个容器的宽度
    </pre>
    <div>
      A: <input type="radio" name="grow-default" id="">100px, 250px, 250px <br>
      B: <input type="radio" name="grow-default" id="">100px, 300px, 200px <br>
      C: <input type="radio" name="grow-default" id="">A，B都不对 <br>
    </div>

    <details>
      <div class="example grow-default">
        <div>
          <div class="box-info">
            <p>flex-basis: 50px</p>
            <p>flex-grow: 1</p>
            <details>
              <p>当前宽度:100px</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basis:100px</p>
            <p>flex-grow:3</p>
            <details>
              <p>当前宽度: 250px</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basis:150px</p>
            <p>flex-grow:2</p>
            <details>
              <p>当前宽度: 250px</p>
            </details>
          </div>
        </div>
      </div>
    </details>

    <details>
      <summary>计算方法</summary>
      <pre>
        容器宽度：600px
        总伸缩系数：1 + 3 + 2 = 6
        空闲宽度：600 - (50 + 100 + 150) =  300
        项目1的flex宽度： 50 + 300 * 1/6 = 100px 
        项目2的flex宽度： 100 + 300 * 3/6 = 250px 
        项目3的flex宽度： 150 + 300 * 2/6 = 250px 
      </pre>
    </details>
    <h3>padding</h3>
    <pre>
      容器宽度：600px
      flex-shrink：1 , 3 , 2 
      flex-basis: 50px, 100px, 150px
      padding: 0 25px
      求各个容器的宽度
    </pre>
    <div>
      A: <input type="radio" name="grow-padding" id="">125px, 225px, 250px <br>
      B: <input type="radio" name="grow-padding" id="">120px, 230px, 250px <br>
      C: <input type="radio" name="grow-padding" id="">A，B都不对 <br>
    </div>
    <details>
      <div class="example grow-padding">
        <div>
          <div class="box-info">
            <p>flex-basis:50px</p>
            <p>flex-grow:1</p>
            <p>padding:0 25px</p>
            <details>
              <p>当前宽度:125px</p>
            </details>

          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basis:100px</p>
            <p>flex-grow:3</p>
            <p>padding:0 25px</p>
            <details>
              <p>当前宽度:225px</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basis:150px</p>
            <p>flex-grow:2</p>
            <p>padding:0 25px</p>
            <details>
              <p>当前宽度:250px</p>
            </details>
          </div>
        </div>
      </div>
    </details>
  </section>
  <h2>flex-shrink:</h2>
  <section class="shrink">
    <h3>test:</h3>
    <pre>
      容器宽度：600px
      flex-shrink：1 , 3 , 2 
      flex-basis: 600px, 600px, 600px
      求各个容器的宽度
    </pre>
    <div>
      A: <input type="radio" name="shrink-test" id="">250px, 150px, 200px <br>
      B: <input type="radio" name="shrink-test" id="">300px, 100px, 200px <br>
      C: <input type="radio" name="shrink-test" id="">A，B都不对 <br>
    </div>
    <details>
      <div class="example shrink-test">
        <div>
          <div class="box-info">
            <p>flex-basis:600px</p>
            <p>flex-shrink:1</p>
            <details>
              <p>当前宽度:400px</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basis:600px</p>
            <p>flex-shrink:3</p>
            <details>
              <p>当前宽度: 0</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basis:600px</p>
            <p>flex-shrink:2</p>
            <details>
              <p>当前宽度:200px</p>
            </details>
          </div>
        </div>
      </div>
    </details>
    <details>
      <summary>计算过程</summary>
      <pre>
        容器宽度：600px
        溢出宽度：600*3 - 600 =  1200
        项目1的flex宽度： 600 - 1200 * 1/6 = 400px 
        项目2的flex宽度： 600 - 1200 * 3/6 = 0px 
        项目3的flex宽度： 600 - 1200 * 2/6 = 200px 
      </pre>
    </details>
    <h3>defalut:</h3>
    <pre>
      容器宽度：600px
      flex-shrink：1 , 3 , 1 
      flex-basis: 200px, 600px, 400px
      求各个容器的宽度
    </pre>
    <div>
      A: <input type="radio" name="shrink-default" id="">150px, 150px, 300px <br>
      B: <input type="radio" name="shrink-default" id="">80px, 240px, 280px <br>
      C: <input type="radio" name="shrink-default" id="">A，B都不对 <br>
    </div>
    <details>
      <div class="example shrink-default">
        <div>
          <div class="box-info">
            <p>flex-basis: 200px</p>
            <p>flex-shrink: 1</p>
            <details>
              <p>当前宽度: 150px</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basis: 600px</p>
            <p>flex-shrink: 3</p>
            <details>
              <p>当前宽度: 150px</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basis: 400px</p>
            <p>flex-shrink: 1</p>
            <details>
              <p>当前宽度: 300px</p>
            </details>
          </div>
        </div>
      </div>
    </details>

    <details>
      <summary>计算过程</summary>
      <pre>
        容器宽度：600px
        溢出宽度：(200 + 600 +400) - 600 = 600px
        项目总权重：200*1 + 600*3 + 400*1 = 2400
        项目1的flex宽度： 200 - 600 * (1*200/2400) = 150px 
        项目2的flex宽度： 600 - 600 * (3*600/2400) = 150px 
        项目3的flex宽度： 400 - 600 * (1*400/2400) = 300px 
      </pre>
    </details>
    <h3>padding:</h3>
    <pre>
      容器宽度：600px
      flex-shrink：1 , 5 , 1 
      flex-basis: 100px, 700px, 300px
      padding: 0 50px
      求各个容器的宽度
    </pre>
    <div>
      A: <input type="radio" name="shrink-padding" id="">179.5px, 82px, 338.5px <br>
      B: <input type="radio" name="shrink-padding" id="">180px, 100px, 320px <br>
      C: <input type="radio" name="shrink-padding" id="">A，B都不对 <br>
    </div>
    <details>
      <div class="example shrink-padding">
        <div>
          <div class="box-info">
            <p>flex-basic: 100px</p>
            <p>flex-shrink: 1</p>
            <p>padding: 50px</p>
            <details>
              <p>当前宽度: 175px</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basic: 700px</p>
            <p>flex-shrink: 5</p>
            <p>padding: 50px</p>
            <details>
              <p>当前宽度: 100px</p>
            </details>
          </div>
        </div>
        <div>
          <div class="box-info">
            <p>flex-basic: 300px</p>
            <p>flex-shrink: 1</p>
            <p>padding: 50px</p>
            <details>
              <p>当前宽度: 325px</p>
            </details>
          </div>
        </div>
      </div>
    </details>
    <details>
      <summary>计算过程</summary>
      <pre>
        容器宽度：600px
        溢出宽度：(200 + 800 + 400)- 600 = 800px
        项目总权重：100*1 + 700*5 + 300*1 = 3900
        项目1的flex宽度： 200 - 800 * (1*100/3900) = ??? 
        项目2的flex宽度： 800 - 800 * (5*700/3900) = ???
        项目3的flex宽度： 400 - 800 * (1*400/3900) = ???

        <details>
          <summary>再次计算</summary>
          项目1的flex宽度：50*2 + (100 - 800 * 1/39) = ???
          项目2的flex宽度：50*2 + (700 - 800 * 35/39)< 50 * 2 + (700 - 800 * 35/40) = 100 + (700 - 700)
          <b>收缩的宽度显然最多只能到0，不能低于0以下！！</b>
          <b>此时，应该会触发flex计算的新特性：触发了min-width的项目，shrink系数变成0，计算溢出宽度时，该项目的宽度按照其min-width属性值计算：</b>
          这样就可重新计算：
          溢出宽度： (200 + 100 + 400) - 600 = 100px
          项目总权重： 100*1 + 700*0 + 300*1 = 400
          项目1的flex宽度： 50*2 + (100 - 100 * (1*100/400)) = 175px
          项目3的flex宽度： 50*2 + (300 - 100 * (1*300/400)) = 325px
        </details>
      </pre>
    </details>
  </section>

  <h2>总结计算公式:</h2>
  <details>
    <p>令 Wfi 为第i个项目经过flex伸缩变化后的宽度 </p>
    <p>令 Wc 为 容器的宽度</p>
    <p>令 Wri 为第i个项目的真实宽度</p>
    <p>令 Wbi 为第i个项目的盒子宽度(margin + border + padding + Wr)</p>
    <p>令 Wbic 为所有项目加起来的盒子宽度总和: () => items.reduce((acc, cur)=>acc+cur.Wb, 0) </p>
    <p>令 Wo 为溢出宽度: ()=> Wbic - Wc > 0 ? Wbic - Wc : 0</p>
    <p>令 Hi 为第i个项目的权重: (item) => item.Wr*item.flexShrink</p>
    <p>令 Hic 为权重和: () => items.reduce((acc, cur)=>acc + cur.Wr*cur.flexShrink, 0)</p>
    <p> <b>在shrink下：</b> </p>
    <p><b> Wfi = (Wbi - Wri) + (Wri - Wo*(Hi/Hic)) </b></p>
  </details>
  </section>
  <h3>参考： https://drafts.csswg.org/css-flexbox-1/#abspos-items</h3>
</body>

</html>